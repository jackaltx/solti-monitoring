# ====================================================================
# Scrape Alloy metrics for log processing statistics
# Generated by solti-monitoring/roles/telegraf
# ====================================================================

[[inputs.prometheus]]
  ## Alloy Prometheus metrics endpoint
  urls = ["http://{{ alloy_server_listen_addr | default('127.0.0.1:12345') }}/metrics"]

  ## Scrape interval (how often to collect metrics)
  interval = "60s"

  ## Timeout for HTTP requests
  timeout = "10s"

  ## Metric version (2 = use Prometheus data model)
  metric_version = 2

  ## Only collect Alloy custom metrics (reduces noise)
  ## This filters OUT built-in Alloy metrics we don't need
  fieldpass = [
    "alloy_bind9_queries_by_type_total",
    "alloy_bind9_spam_queries_dropped_total",
    "alloy_bind9_security_events_total",
    "alloy_bind9_zone_transfers_total"
  ]

  ## Add tags to all metrics from this input
  [inputs.prometheus.tags]
    service = "alloy"
    collector = "telegraf"

## Notes:
## - Alloy exposes metrics at http://IP:12345/metrics (Prometheus format)
## - Telegraf converts Prometheus metrics to InfluxDB line protocol
## - Metrics are counters (always increasing), use derivative() in queries
